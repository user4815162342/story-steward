#summary How to Build Story Steward
#labels Phase-Implementation

= Introduction =

Unfortunately, a number of factors make the process for creating the packages found in the downloads section relatively tedious. Fortunately, most of it is done via scripts, and after the initial build, quick building for development and testing is a snap. 

However, initial set up for building requires a number of steps. Also, a full 'make all' can take a long time (at least an hour on my, admittedly old, machine).

= Requirements =

In addition to the line tools, there are several third-party libraries which are not included in source control due to their size, and due to my dislike of duplicating repositories (All of these are open source). If you are unable to obtain the required versions as listed below, let me know and I'd be willing to upload them to a file transfer site for you. Newer versions may work, but haven't been tested.

Tools:
  * Java Runtime (My version is 1.6, I have not tried it with earlier versions)
  * Windows Batch File interpreter (cmd --version on my machine produces 5.1.2600) (NOTE: Windows is only required for building, not for running)
  * Subversion command line client, with svnversion command (My version is 1.6.15)

Libraries:
  * Dojo Toolkit v1.5 full source build
  * Math.uuid.js v1.4 from http://www.broofa.com
  * famfamfam Silk Icons v1.3 (only if you plan on modifying the icons)

= Setup =

1) Make sure you have checked out the latest source into a directory structure that looks like this:

  * build/
  * documentation/
  * resources/
  * source/
  * test/

2) Now, at the same level as the above, create the following directories:

  * vendor/
  * development/
  * release/
  * deploy/

3) Unzip the dojo toolkit source build into vendor, so that you end up with a directory structure something like this:

  * vendor/
    * dojo/
      * dojo/
      * dijit/
      * dojox/
      * util/

4) Place the Math.uuid.js script directly under vendor, and unzip the famfamfam file into a directory called famfam-silkicons.

5) Make sure the java runtime is set up on your path environment variable.

= Building =

Assuming everything is working right, open up a command shell and change to the build directory in the structure above. Run 'make' to call the make.bat script and see a basic usage.

== Building Custom Dojo ==

The first time you start building, you will want to create the custom build of dojo in your release and development directories. This is the longest part of the build process, however as long as you are not adding any new dojo components, or changing the build scripts, you should only ever need to run this once. 

To build the custom dojo scripts, simply run 'make dojo'. This will create the custom build scripts, and shrink the 'release' target by removing unneeded components from the dojo library. 

If you also want to shrink the 'development' target, you will need to explicitly state 'make dojo all' or 'make dojo development'. However, only do this if you do not plan on adding new dojo components to the basic Story Steward code.

== Building for Testing Changes ==

After this, whenever you make changes, you will want to test them from the 'development' or 'release' directories. The main difference between these is that the dojo scripts aren't quite as compact, and therefore little easier to debug in the development release.

In order to test them, you simply need to populate the changes via 'make application'. You can optionally specify the target 'development' or 'release' as a second parameter. 

Sometimes, you may want to call 'make clean' first. This will clean out all of the application code, but not the dojo code, so you can be sure there aren't some old files sticking around.

== Building for Deployment ==

When you are ready to create deployment packages, call 'make deploy', optionally specifying 'development' or 'release'. This process also takes a while, although not nearly as long as building the custom dojo.

== Building 'icons.png' ==

If you want to make changes to the icons used in the application, you will need to regenerate icons.png. This is not done in windows, as the process requires !ImageMagick, and the shell script is therefore written for linux. So, from a linux machine, or possibly a cygwin prompt, change the directory to /resources/icons, and call the script 'creaticons.png.sh'. 

If you're source is not stored in a place which is accessible to the linux machine, you will only need to copy the following folders over to such a machine in order to rebuild the icons:

  * vendor/famfam-silkicons/
  * resources/icons/